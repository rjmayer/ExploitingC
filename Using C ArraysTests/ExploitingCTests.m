//
//  Using_C_ArraysTests.m
//  Using C ArraysTests
//
//  Created by Richard Mayer on 24/06/2013.
//  Copyright (c) 2013 Richard Mayer. All rights reserved.
//

#import "ExploitingCTests.h"

#import "NSDictionaryAsConst.h"

@implementation ExploitingCTests

- (void)setUp
{
    [super setUp];
    
    // Set-up code here.
}

- (void)tearDown
{
    // Tear-down code here.
    
    [super tearDown];
}

-(void)testEnumAndArrayConsistency
{
    // Test 1
    NSLog(@"Testing the correct structure of enum FruitType...");
    
    for (FruitType userDataType = FruitTypeFirst;
         userDataType <= FruitTypeLast;
         ++userDataType)
    {
        NSLog(@"Enumeration 0 = %d", userDataType);
    }
    
    // There is an ...Unknown enumeration = -1
    NSLog(@"FruitTypeUnknown = %d (expect -1)", FruitTypeUnknown);
    STAssertTrue(FruitTypeUnknown == -1, nil);
    
    // There is a ...First enumeration = 0
    NSLog(@"FruitTypeFirst = %d (expect 0)", FruitTypeFirst);
    STAssertTrue(FruitTypeFirst == 0, nil);
    
    // There is an ...Last enumeration > 0
    NSLog(@"FruitTypeLast = %d (expect 0 or larger)", FruitTypeLast);
    STAssertTrue(FruitTypeLast >= 0, nil);
    
    // Test that enumerations map onto the array of structs
    int arraySize = sizeof(fruitDefsArray) / sizeof(FruitType);
    
    STAssertTrue(arraySize <= FruitTypeLast+1, @"Enum/array mismatch - too few array elements");
    STAssertTrue(arraySize >= FruitTypeLast+1, @"Enum/array mismatch - too few enumerations");
    STAssertTrue(arraySize == FruitTypeLast+1, @"Enumerations and array elements should map 1 to 1 but dont.");
}

- (void)testFruitTypeApple
{
    // Test Condition
    NSNumber* fruitTypeIndex = [NSNumber numberWithInt:FruitTypeApple];
    
    // The Test
    NSDictionaryAsConst* unitUnderTest = [[NSDictionaryAsConst alloc] init];
    
    NSDictionary* result = [unitUnderTest dictionaryForFruit:FruitTypeApple];
    
    // Evaluation 1
    // Check that the wrapper dict is correct
    STAssertNotNil([result objectForKey:fruitTypeIndex], @"SHIT");
    
    // Evaluation 2
    // Check that the contents are correc
    NSDictionary* fruitDefinition = [result objectForKey:fruitTypeIndex];
    
    NSLog(@"FruitTypeApple's name is '%@' it's colour is '%@'",
          [fruitDefinition objectForKey:@"Name"],
          [fruitDefinition objectForKey:@"Colour"]);
}

- (void)testFruitTypeBanana
{
    // Test Condition
    NSNumber* fruitTypeIndex = [NSNumber numberWithInt:FruitTypeBanana];
    
    // The Test
    NSDictionaryAsConst* unitUnderTest = [[NSDictionaryAsConst alloc] init];
    
    NSDictionary* result = [unitUnderTest dictionaryForFruit:FruitTypeBanana];
    
    // Evaluation 1
    // Check that the wrapper dict is correct
    STAssertNotNil([result objectForKey:fruitTypeIndex], @"SHIT");
    
    // Evaluation 2
    // Check that the contents are correc
    NSDictionary* fruitDefinition = [result objectForKey:fruitTypeIndex];
    
    NSLog(@"FruitTypeBanana's name is '%@' it's colour is '%@'",
          [fruitDefinition objectForKey:@"Name"],
          [fruitDefinition objectForKey:@"Colour"]);
}

- (void)testFruitTypeDefault
{
    // Test Condition
    NSNumber* fruitTypeIndex = [NSNumber numberWithInt:FruitTypeDefault];
    
    // The Test
    NSDictionaryAsConst* unitUnderTest = [[NSDictionaryAsConst alloc] init];
    
    NSDictionary* result = [unitUnderTest dictionaryForFruit:FruitTypeDefault];
    
    // Evaluation 1
    // Check that the wrapper dict is correct
    STAssertNotNil([result objectForKey:fruitTypeIndex], @"SHIT");
    
    // Evaluation 2
    // Check that the contents are correc
    NSDictionary* fruitDefinition = [result objectForKey:fruitTypeIndex];
    
    NSLog(@"FruitTypeDefault's name is '%@' it's colour is '%@'",
          [fruitDefinition objectForKey:@"Name"],
          [fruitDefinition objectForKey:@"Colour"]);
}

- (void)testFruitTypeUnknown
{
    // Test Condition
    NSNumber* fruitTypeIndex = [NSNumber numberWithInt:FruitTypeUnknown];
    
    // The Test
    NSDictionaryAsConst* unitUnderTest = [[NSDictionaryAsConst alloc] init];
    
    NSDictionary* result = [unitUnderTest dictionaryForFruit:FruitTypeUnknown];
    
    // Evaluation 1
    // Check that the wrapper dict is correct
    STAssertNil([result objectForKey:fruitTypeIndex], @"SHIT");
    
    // Evaluation 2
    // Check that the contents are correc
    NSDictionary* fruitDefinition = [result objectForKey:fruitTypeIndex];
    
    NSLog(@"FruitTypeUnknown's name is '%@' it's colour is '%@'",
          [fruitDefinition objectForKey:@"Name"],
          [fruitDefinition objectForKey:@"Colour"]);
}

- (void)testFruitTypeInvalid
{
    // Test Condition
    NSNumber* fruitTypeIndex = [NSNumber numberWithInt:INT16_MIN];
    
    // The Test
    NSDictionaryAsConst* unitUnderTest = [[NSDictionaryAsConst alloc] init];
    
    NSDictionary* result = [unitUnderTest dictionaryForFruit:INT16_MIN];
    
    // Evaluation 1
    // Check that the wrapper dict is correct
    STAssertNil([result objectForKey:fruitTypeIndex], @"SHIT");
}

@end
